'use strict';

const Funnel = require('broccoli-funnel');
const PersistentFilter = require('broccoli-persistent-filter');
const stripIndent = require('common-tags').stripIndent;

module.exports = class TemplateTypeGenerator {
  constructor() {
    this.name = 'template-type-generator';
  }

  toTree(type, input) {
    let hbs = new Funnel(input, { include: ['**/*.hbs'] });
    return new TemplateTypesPlugin(hbs);
  }
}

class TemplateTypesPlugin extends PersistentFilter {
  processString() {
    return stripIndent`
      // This is an autogenerated file. Do not edit this file directly.
      import { TemplateFactory } from 'htmlbars-inline-precompile';

      declare const template: TemplateFactory;
      export default template;
    `;
  }

  getDestFilePath(inputPath) {
    return inputPath.replace(/\.hbs$/, '.d.ts');
  }
}
